module "postgresql_db" {
  source                            = "../fully-configurable"
  ibmcloud_api_key                  = var.ibmcloud_api_key
  existing_resource_group_name      = var.existing_resource_group_name
  prefix                            = var.prefix
  name                              = var.name
  provider_visibility               = "private"
  region                            = var.region
  existing_postgresql_instance_crn  = var.existing_postgresql_instance_crn
  postgresql_version                = var.postgresql_version
  remote_leader_crn                 = var.remote_leader_crn
  members                           = var.members
  member_memory_mb                  = var.member_memory_mb
  member_cpu_count                  = var.member_cpu_count
  member_disk_mb                    = var.member_disk_mb
  member_host_flavor                = var.member_host_flavor
  service_credential_names          = var.service_credential_names
  admin_pass                        = var.admin_pass
  users                             = var.users
  configuration                     = var.configuration
  resource_tags                     = var.resource_tags
  access_tags                       = var.access_tags
  kms_encryption_enabled            = true
  existing_kms_instance_crn         = var.existing_kms_instance_crn
  existing_kms_key_crn              = var.existing_kms_key_crn
  kms_endpoint_type                 = "private"
  skip_postgresql_kms_auth_policy   = var.skip_postgresql_kms_auth_policy
  ibmcloud_kms_api_key              = var.ibmcloud_kms_api_key
  key_ring_name                     = var.key_ring_name
  key_name                          = var.key_name
  existing_backup_kms_key_crn       = var.existing_backup_kms_key_crn
  use_default_backup_encryption_key = false
  backup_crn                        = var.backup_crn
  auto_scaling                      = var.auto_scaling
  service_endpoints                 = "private"
}
